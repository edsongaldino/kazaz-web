<section class="page">
  <header class="page__header">
    <h1>{{ modoEdicao() ? 'Editar Cliente' : 'Cadastrar Cliente' }}</h1>
    <div class="header__actions">
      <button mat-stroked-button (click)="cancelar()">
        <mat-icon>arrow_back</mat-icon>
        Voltar
      </button>
    </div>
  </header>

  <mat-progress-bar *ngIf="loading()" mode="indeterminate"></mat-progress-bar>
  <div *ngIf="errorMsg()" class="error">{{ errorMsg() }}</div>

  <!-- üëá ADICIONE O FORM AQUI -->
  <form [formGroup]="form" (ngSubmit)="salvar()">

    <mat-card>
      <mat-card-header>
        <mat-card-title><mat-icon>account_circle</mat-icon> Dados B√°sicos</mat-card-title>
      </mat-card-header>

      <div class="grid">
        <mat-form-field appearance="outline" class="col-3">
          <mat-label>Tipo</mat-label>
          <mat-select [formControl]="form.controls.tipo">
            <mat-option value="PF">Pessoa F√≠sica</mat-option>
            <mat-option value="PJ">Pessoa Jur√≠dica</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="col-3">
          <mat-label>{{ form.controls.tipo.value === 'PF' ? 'CPF' : 'CNPJ' }}</mat-label>
          <input matInput [formControl]="form.controls.documento"
                 (input)="maskDocumento(form.controls.documento.value || '')"
                 inputmode="numeric" />
          <mat-error *ngIf="form.controls.documento.hasError('required')">Documento obrigat√≥rio</mat-error>
          <mat-error *ngIf="form.controls.documento.hasError('cpf')">CPF inv√°lido</mat-error>
          <mat-error *ngIf="form.controls.documento.hasError('cnpj')">CNPJ inv√°lido</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="col-3">
          <mat-label>Origem</mat-label>
          <!-- ‚úÖ agora pode usar formControlName -->
          <mat-select formControlName="origemId">
            <mat-option [value]="null">Sem origem</mat-option>
            <mat-option *ngFor="let o of origens" [value]="o.id">
              {{ o.nome }}
            </mat-option>
          </mat-select>
          <mat-hint *ngIf="form.get('origemId')?.value as oid">
            {{ hintOrigem(oid) }}
          </mat-hint>
        </mat-form-field>

        <mat-form-field appearance="outline" class="col-3" *ngIf="form.controls.tipo.value === 'PF'">
          <mat-label>Estado Civil</mat-label>
          <mat-select [formControl]="form.controls.estadoCivil">
            <mat-option value="SOLTEIRO">Solteiro</mat-option>
            <mat-option value="CASADO">Casado</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- PF -->
        <ng-container *ngIf="form.controls.tipo.value === 'PF'">
          <mat-form-field appearance="outline" class="col-5">
            <mat-label>Nome</mat-label>
            <input matInput [formControl]="form.controls.nome" />
            <mat-error *ngIf="form.controls.nome.hasError('required')">Informe o nome</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col-2">
            <mat-label>Data de Nascimento</mat-label>
            <input matInput type="date" [formControl]="form.controls.dataNascimento"/>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col-3">
            <mat-label>RG</mat-label>
            <input matInput [formControl]="form.controls.rg" />
            <mat-error *ngIf="form.controls.rg.hasError('required')">RG</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col-2">
            <mat-label>√ìrg√£o Exp.</mat-label>
            <input matInput [formControl]="form.controls.orgaoExpedidor" />
            <mat-error *ngIf="form.controls.orgaoExpedidor.hasError('required')">√ìrg√£o expedidor</mat-error>
          </mat-form-field>

        </ng-container>

        <!-- PJ -->
        <ng-container *ngIf="form.controls.tipo.value === 'PJ'">

          <mat-form-field appearance="outline" class="col-2">
            <mat-label>Data de Abertura</mat-label>
            <input matInput type="date" [formControl]="form.controls.dataAbertura"/>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col-5">
            <mat-label>Raz√£o Social</mat-label>
            <input matInput [formControl]="form.controls.razaoSocial" />
            <mat-error *ngIf="form.controls.razaoSocial.hasError('required')">Informe a raz√£o social</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col-4">
            <mat-label>Nome Fantasia</mat-label>
            <input matInput [formControl]="form.controls.nomeFantasia" />
          </mat-form-field>
        </ng-container>
      </div>
  </mat-card>
  <mat-card>
      <mat-card-header>
        <mat-card-title><mat-icon>account_circle</mat-icon> Endere√ßo</mat-card-title>
      </mat-card-header>
      <app-endereco *ngIf="enderecoForm" [formGroup]="enderecoForm"></app-endereco>
  </mat-card>

  <mat-card>
      <mat-card-header>
        <mat-card-title><mat-icon>account_circle</mat-icon> Dados de Contato</mat-card-title>
      </mat-card-header>
      <app-dados-contato formControlName="contatos"></app-dados-contato>
  </mat-card>

  <mat-card *ngIf="form.controls.tipo.value === 'PF' && form.controls.estadoCivil.value === 'CASADO'">
    <mat-card-header>
      <mat-card-title><mat-icon>account_circle</mat-icon> Dados do c√¥njuge</mat-card-title>
    </mat-card-header>

    <!-- ‚úÖ agora passa um FormGroup de verdade -->
    <app-dados-conjuge [formGroup]="conjugeForm"></app-dados-conjuge>
  </mat-card>

  <mat-card>
      <mat-card-header>
        <mat-card-title><mat-icon>account_circle</mat-icon> Dados Complementares</mat-card-title>
      </mat-card-header>
      <app-dados-complementares [formGroup]="form.controls.dadosComplementares"></app-dados-complementares>
  </mat-card>

  <mat-card>
    <div class="actions">
        <button mat-stroked-button type="button" (click)="cancelar()">Cancelar</button>
        <!-- ‚úÖ usa submit do form -->
        <button mat-flat-button color="primary" type="submit" [disabled]="saving()">
          <mat-icon>save</mat-icon>
          {{ modoEdicao() ? 'Salvar altera√ß√µes' : 'Salvar' }}
        </button>
      </div>
  </mat-card>
      

    

  </form>
</section>
